<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="Projects by Ali Shabestary — selected architectural works and case studies.">
  <title>Projects – ALI SHABESTARY</title>
  <link rel="stylesheet" href="style.css?v=20251021a">
  <link rel="icon" href="favicon.png" type="image/png">
  <!-- theme-color removed for cross-browser linting -->
  <link rel="canonical" href="https://alishabestary.com/projects.html">
  <link rel="preload" href="fonts/Bahnschrift.woff" as="font" type="font/woff" crossorigin>
  <meta property="og:title" content="Projects — Ali Shabestary">
  <meta property="og:description" content="Explore selected architectural projects and visual studies.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://alishabestary.com/projects.html">
  <meta property="og:image" content="https://alishabestary.com/images/preview2.png">
  <meta name="twitter:card" content="summary_large_image">
</head>
<body class="projects-page">
  <a class="skip-link" href="#main">Skip to content</a>
  <header>
    <a href="index.html" class="site-name" aria-label="Home">ALI SHABESTARY</a>
    <nav class="nav-dropdown" role="navigation" aria-label="Main navigation">
      <a href="projects.html" aria-label="Projects page" aria-current="page">Projects</a>
      <a href="about.html" aria-label="About page">About</a>
      <a href="contact.html#contact-form" aria-label="Contact page">Contact</a>
    </nav>
  </header>
  <main id="main">
    <div class="project-grid" id="projects-grid">
      <div class="project-item" data-link="extendedportfolio.html">
        <img loading="lazy" class="lazy" data-src="images/thumb1.jpg" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'/%3E" alt="Project 1">
        <div class="preview"><img loading="lazy" class="lazy" data-src="images/preview1.jpg" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'/%3E" alt="Extended Portfolio"></div>
        <div class="title">EXTENDED PORTFOLIO</div>
      </div>
      <!-- Dynamic project tiles will be injected here below via data/projects.json -->
    </div>
  </main>
  <script defer src="script.js"></script>
  <script>
  // Build project tiles dynamically from data/projects.json; support explicit thumbs/previews
  (function(){
    const grid = document.getElementById('projects-grid');
    if (!grid) return;
    function encPath(parts) { return parts.map(p => encodeURIComponent(p)).join('/'); }
    function makeItem(p){
      const href = p.href || ('project' + p.num + '.html');
      const title = p.title || ('Project ' + p.num);
      const alt = p.alt || (title + ' preview');
      const base = String(p.heroBase || '').trim();
      const ext = String(p.heroExt || 'jpg').toLowerCase();
      const thumb = p.thumb ? encodeURI(p.thumb) : encPath(['images','resized','400','project ' + p.num, base + '.' + ext]);
      const preview = p.preview ? encodeURI(p.preview) : encPath(['images','resized','1200','project ' + p.num, base + '.' + ext]);
      const item = document.createElement('div');
      item.className = 'project-item';
      item.setAttribute('data-link', href);
      item.innerHTML = [
        `<img loading="lazy" decoding="async" class="lazy" data-src="${thumb}" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'/%3E" alt="${alt}">`,
        `<div class="preview"><img loading="lazy" decoding="async" class="lazy" data-src="${preview}" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'/%3E" alt="${alt}"></div>`,
        `<div class="title">${title}</div>`
      ].join('');
      return item;
    }
    fetch('data/projects.json?v=20251022a')
      .then(r => r.json())
      .then(data => {
        const listRaw = (data && Array.isArray(data.projects)) ? data.projects : [];
        // Sort numerically by project number (ascending). Fallback: extract from href like "project5.html".
        function numOf(p){
          const direct = Number(p && p.num);
          if (Number.isFinite(direct)) return direct;
          const m = (p && p.href && String(p.href).match(/project\s*(\d+)\.html/i)) || null;
          if (m) return Number(m[1]);
          return Number.POSITIVE_INFINITY;
        }
        // Pin project 5 to the very end regardless of numeric order
        const isFive = (p) => numOf(p) === 5 || /project\s*5\.html/i.test(String(p && p.href || ''));
        const fives = listRaw.filter(isFive);
        const others = listRaw.filter(p => !isFive(p)).sort((a,b) => numOf(a) - numOf(b));
        // Split non-5 into pre-2 and mid (>=2)
        const preTwo = others.filter(p => numOf(p) < 2);
        const mid = others.filter(p => numOf(p) >= 2);

        // Build elements
        const preEls = preTwo.map(p => { try { return makeItem(p); } catch(e){ console.error('Tile build failed', p, e); return null; } }).filter(Boolean);
        const midEls = mid.map(p => { try { return makeItem(p); } catch(e){ console.error('Tile build failed', p, e); return null; } }).filter(Boolean);
        const fiveEls = fives.map(p => { try { return makeItem(p); } catch(e){ console.error('Tile build failed', p, e); return null; } }).filter(Boolean);

        // Insert pre-2 tiles after project1 if present; otherwise directly after the first static tile
        if (preEls.length) {
          const fragPre = document.createDocumentFragment(); preEls.forEach(el => fragPre.appendChild(el));
          const anchor = grid.querySelector('.project-item[data-link="project1.html"]');
          if (anchor && anchor.parentNode) {
            anchor.parentNode.insertBefore(fragPre, anchor.nextSibling);
          } else {
            const afterFirst = grid.children[0] ? grid.children[0].nextSibling : null; // after static Extended Portfolio tile
            grid.insertBefore(fragPre, afterFirst);
          }
        }
        // Append mid tiles, then project 5 tiles last
        const fragMid = document.createDocumentFragment(); midEls.forEach(el => fragMid.appendChild(el));
        grid.appendChild(fragMid);
        const fragFive = document.createDocumentFragment(); fiveEls.forEach(el => fragFive.appendChild(el));
        grid.appendChild(fragFive);
        // Bind navigation for all items (existing + injected)
        grid.querySelectorAll('.project-item[data-link]').forEach(function(item){
          if (item.__boundClick) return; item.__boundClick = true;
          item.addEventListener('click', function(){ const link = item.getAttribute('data-link'); if (link) window.location.href = link; });
        });
        // Kick off lazy images for immediate visual
        document.querySelectorAll('#projects-grid img.lazy[data-src]').forEach(function(img){
          if (!img.src || img.src.startsWith('data:')) { img.src = img.getAttribute('data-src'); }
        });
      })
      .catch(err => console.error('projects.json fetch error', err));
  })();
  </script>
  <!-- Cloudflare Web Analytics -->
  <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "2bf51f27e97d4e239093462e66dd4b5f"}'></script>
</body>
</html>