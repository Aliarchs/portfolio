<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Extended Portfolio â€“ ALI SHABESTARY</title>
	<link rel="stylesheet" href="style.css?v=20251008">
	<link rel="icon" href="favicon.png" type="image/png">
	<style>
		/* Extended Portfolio scroll-snap styles */
		.portfolio-container {
			/* Subtract a couple of pixels to avoid fractional rounding overflow on some setups */
			height: calc(100dvh - var(--header-h, 0px) - 2px);
			overflow-x: auto;
			overflow-y: hidden;
			scroll-snap-type: x mandatory;
			display: flex;
			scroll-behavior: smooth;
			margin-top: var(--header-h, 0px);
		}
		.portfolio-page {
			min-width: 100vw;
			height: 100%;
			scroll-snap-align: start;
			display: flex;
			align-items: center;
			justify-content: center;
			position: relative;
			background: var(--bg-color);
		}
		.portfolio-nav {
			position: fixed;
			top: 50%;
			transform: translateY(-50%);
			z-index: 1000;
			width: var(--arrow-size);
			height: var(--arrow-size);
			background: rgba(0,0,0,0.55);
			border: none;
			border-radius: 50%;
			color: #fff;
			font-size: var(--arrow-font-size);
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			box-shadow: 0 6px 20px rgba(0,0,0,0.30);
			-webkit-backdrop-filter: blur(2px);
			backdrop-filter: blur(2px);
			transition: background 0.18s ease, transform 0.1s;
			font-family: monospace;
			line-height: 1;
		}
		.portfolio-nav.prev { left: 2rem; }
		.portfolio-nav.next { right: 2rem; }
		.portfolio-nav.hidden { display: none; }
    
		/* Smaller arrows and tighter inset on mobile/tablet */
			@media (max-width: 900px) {
				/* Scope sizes to this page's arrows only to avoid leaking to global variables */
				.portfolio-nav { width: 2rem; height: 2rem; font-size: 0.9rem; }
				.portfolio-nav.prev { left: 1rem; }
				.portfolio-nav.next { right: 1rem; }
			}

		/* Mobile landscape: ensure the whole page fits the screen height */
		@media (max-width: 900px) and (orientation: landscape) {
			.portfolio-container { height: calc(100dvh - var(--header-h, 0px) - 2px); }
			.portfolio-spread img,
			#portfolioContainer.mobile-mode .mobile-page img {
				max-height: calc(100dvh - var(--header-h, 0px) - 2px);
			}
			/* Cover image stays at 90% of available height in landscape mobile */
			.portfolio-cover img { max-height: calc((100dvh - var(--header-h, 0px) - 2px) * 0.9); }
		}

		/* Prevent the wrapper under the fixed arrows from adding page height on desktop */
		.portfolio-nav-bar { height: 0; overflow: visible; }
    
		.end-label {
			position: absolute;
			bottom: 2rem;
			left: 50%;
			transform: translateX(-50%);
			color: var(--text-color);
			font-size: 0.9rem;
			opacity: 0.7;
		}
    
		/* Portfolio page layouts */
		.portfolio-cover, .portfolio-spread {
			min-width: 100vw;
			height: 100%;
			scroll-snap-align: start;
			display: flex;
			align-items: center;
			justify-content: center; /* center 90vw content */
			position: relative;
			background: var(--bg-color);

		}
    
		.portfolio-cover img {
			/* Fit inside page area beneath header at 90% of available height */
			height: auto;
			max-height: calc((100dvh - var(--header-h, 0px) - 2px) * 0.9);
			max-width: 86vw;
			width: auto;
			object-fit: contain;
		}
    
		.portfolio-spread {
			gap: 0; /* No gap - pages touch in the middle */
		}

		/* Non-scaled soft shadow behind the spread (exactly image area) */
	.spread-shadow {
			position: absolute;
			left: 50%;
			top: 50%;
			transform: translate(-50%, -50%);
	width: 90vw; /* match two pages (45vw + 45vw) */
	height: var(--spread-img-height, 100%); /* match image height */
			pointer-events: none;
			z-index: 1; /* behind images and spine overlays */
			border-radius: 2px;
			box-shadow:
				0 18px 72px rgba(0,0,0,0.12),
				0 6px 32px rgba(0,0,0,0.08);
		}
    
		/* Side halo with hard top/bottom cutoff */
	.portfolio-spread::before {
			content: '';
			position: absolute;
			left: 50%;
			top: 50%;
			transform: translate(-50%, -50%);
	width: clamp(50px, 5.5vw, 200px); /* scaled to 90vw content */
		height: var(--spread-img-height, 100%); /* match image area (hard vertical cutoff) */
			pointer-events: none;
			z-index: 9;
			/* two-layer halo: broad subtle base + existing medium halo */
			background:
				linear-gradient(to right,
					rgba(0,0,0,0) 0%,
					rgba(0,0,0,0.025) 20%,
					rgba(0,0,0,0.05) 50%,
					rgba(0,0,0,0.025) 80%,
					rgba(0,0,0,0) 100%),
				linear-gradient(to right,
					rgba(0,0,0,0) 0%,
					rgba(0,0,0,0.06) 35%,
					rgba(0,0,0,0.12) 50%,
					rgba(0,0,0,0.06) 65%,
					rgba(0,0,0,0) 100%);
		}

		/* Narrow middle line with subtle vertical softening only here */
	.portfolio-spread::after {
			content: '';
			position: absolute;
			left: 50%;
			top: 50%;
			transform: translate(-50%, -50%);
	width: clamp(4px, 0.6vw, 12px); /* subtler, narrower center line */
		height: var(--spread-img-height, 100%);
			pointer-events: none;
			z-index: 10;
			background: linear-gradient(to right,
				rgba(0,0,0,0) 0%,
				rgba(0,0,0,0.08) 50%,
				rgba(0,0,0,0) 100%);
			-webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 6%, black 94%, transparent 100%);
			mask-image: linear-gradient(to bottom, transparent 0%, black 6%, black 94%, transparent 100%);
		}
    
		.portfolio-spread img {
			max-height: 100%;
			width: 45vw; /* two pages = 90vw total */
			object-fit: contain;
		}

		/* Eliminate inline baseline gaps and any perceived thin border around images */
		.portfolio-cover picture,
		.portfolio-spread picture {
			display: block;
			line-height: 0;
			background: transparent;
		}
		.portfolio-cover img,
		.portfolio-spread img {
			display: block;
			border: 0;
			box-shadow: none;
			background: transparent;
		}

		/* Mobile single-page slides (created dynamically) */
		.mobile-page { display: none; }
		#portfolioContainer.mobile-mode .mobile-page {
			min-width: 100vw;
			height: 100%;
			scroll-snap-align: start;
			display: flex;
			align-items: center;
			justify-content: center;
			background: var(--bg-color);
			position: relative;
		}
		#portfolioContainer.mobile-mode .mobile-page img {
			max-height: 90vh;
			max-width: 90vw;
			object-fit: contain;
		}
		#portfolioContainer.mobile-mode .portfolio-spread { display: none; }

		/* Mobile portrait: place pages under header, scale images to 90% width, and put arrows below image */
	@media (max-width: 900px) and (orientation: portrait) {
			/* Ensure the portfolio starts below the fixed header, keep horizontal scroll */
			.portfolio-container {
				margin-top: calc(var(--header-h, 0px) + 0.5rem);
				padding-top: 0;
				height: auto;
				display: flex;            /* keep horizontal strip */
				overflow-x: auto;         /* allow horizontal paging */
				overflow-y: visible;      /* allow nav bar below */
			}

			/* Show single-image slides in mobile mode at 90% viewport width */
			#portfolioContainer.mobile-mode .mobile-page {
				height: auto;             /* image height defines section */
				min-height: 0;
			}
			#portfolioContainer.mobile-mode .mobile-page img {
				width: 90vw;
				max-width: 90vw;
				height: auto;
				max-height: none;
				display: block;
				margin: 0.5rem auto 0;
				object-fit: contain;
			}

			/* Make cover image 90vw in portrait and let height auto */
			.portfolio-cover img {
				max-width: 90vw;
				width: 90vw;
				height: auto;
				max-height: none;
			}

			/* Navigation arrows appear below the image, centered */
			.portfolio-nav-bar {
				display: flex;
				justify-content: center;
				align-items: center;
				gap: 1rem;
				margin: 0.75rem auto 1.25rem;
				padding: 0;
				width: 100%;
				height: auto; /* override desktop 0-height so arrows sit below image */
			}
			.portfolio-nav {
				position: static;
				top: auto;
				transform: none;
				display: inline-flex;
				align-items: center;
				justify-content: center;
				width: clamp(44px, 12vw, 56px);
				height: clamp(44px, 12vw, 56px);
				font-size: clamp(20px, 6vw, 28px);
				line-height: 1;
				border-radius: 999px;
			}
		}
	</style>
</head>
<body>
	<header>
		<a href="index.html" class="site-name" aria-label="Home">ALI SHABESTARY</a>
		<nav class="nav-dropdown" role="navigation" aria-label="Main navigation">
			<a href="projects.html" aria-label="Projects page">Projects</a>
			<a href="about.html" aria-label="About page">About</a>
			<a href="contact.html#contact-form" aria-label="Contact page">Contact</a>
		</nav>
	</header>
	<div class="portfolio-container" id="portfolioContainer">
    
		<!-- Cover Page (stands alone) -->
		<div class="portfolio-cover">
	<img src="images/resized/1200/project1-1.jpg" alt="Architecture Portfolio Cover" loading="eager" decoding="async">
		</div>
    
		<!-- Spread 1: Pages 2-3 -->
		<div class="portfolio-spread">
	<img src="images/resized/1200/project1-2.jpg" alt="Portfolio Page 2" loading="lazy" decoding="async">
	<img src="images/resized/1200/project1-3.jpg" alt="Portfolio Page 3" loading="lazy" decoding="async">
		</div>
    
		<!-- Spread 2: Pages 4-5 -->
		<div class="portfolio-spread">
	<img src="images/resized/1200/project1-4.jpg" alt="Portfolio Page 4" loading="lazy" decoding="async">
	<img src="images/resized/1200/project1-5.jpg" alt="Portfolio Page 5" loading="lazy" decoding="async">
		</div>
    
		<!-- Spread 3: Pages 6-7 -->
		<div class="portfolio-spread">
	<img src="images/resized/1200/project1-6.jpg" alt="Portfolio Page 6" loading="lazy" decoding="async">
	<img src="images/resized/1200/project1-7.jpg" alt="Portfolio Page 7" loading="lazy" decoding="async">
		</div>
    
		<!-- Spread 4: Pages 8-9 -->
		<div class="portfolio-spread">
	<img src="images/resized/1200/project1-8.jpg" alt="Portfolio Page 8" loading="lazy" decoding="async">
	<img src="images/resized/1200/project1-9.jpg" alt="Portfolio Page 9" loading="lazy" decoding="async">
		</div>
    
		<!-- Spread 5: Pages 10-11 -->
		<div class="portfolio-spread">
	<img src="images/resized/1200/project1-10.jpg" alt="Portfolio Page 10" loading="lazy" decoding="async">
	<img src="images/resized/1200/project1-11.jpg" alt="Portfolio Page 11" loading="lazy" decoding="async">
		</div>
    
		<!-- Spread 6: Pages 12-13 -->
		<div class="portfolio-spread">
	<img src="images/resized/1200/project1-12.jpg" alt="Portfolio Page 12" loading="lazy" decoding="async">
	<img src="images/resized/1200/project1-13.jpg" alt="Portfolio Page 13" loading="lazy" decoding="async">
		</div>
    
		<!-- Spread 7: Pages 14-15 -->
		<div class="portfolio-spread">
	<img src="images/resized/1200/project1-14.jpg" alt="Portfolio Page 14" loading="lazy" decoding="async">
	<img src="images/resized/1200/project1-15.jpg" alt="Portfolio Page 15" loading="lazy" decoding="async">
		</div>
    
		<!-- Spread 8: Pages 16-17 -->
		<div class="portfolio-spread">
	<img src="images/resized/1200/project1-16.jpg" alt="Portfolio Page 16" loading="lazy" decoding="async">
	<img src="images/resized/1200/project1-17.jpg" alt="Portfolio Page 17" loading="lazy" decoding="async">
		</div>
    
		<!-- Spread 9: Pages 18-19 -->
		<div class="portfolio-spread">
	<img src="images/resized/1200/project1-18.jpg" alt="Portfolio Page 18" loading="lazy" decoding="async">
	<img src="images/resized/1200/project1-19.jpg" alt="Portfolio Page 19" loading="lazy" decoding="async">
		</div>
    
		<!-- Spread 10: Pages 20-21 -->
		<div class="portfolio-spread">
	<img src="images/resized/1200/project1-20.jpg" alt="Portfolio Page 20" loading="lazy" decoding="async">
	<img src="images/resized/1200/project1-21.jpg" alt="Portfolio Page 21" loading="lazy" decoding="async">
		</div>
    
		<!-- Spread 11: Pages 22-23 -->
		<div class="portfolio-spread">
	<img src="images/resized/1200/project1-22.jpg" alt="Portfolio Page 22" loading="lazy" decoding="async">
	<img src="images/resized/1200/project1-23.jpg" alt="Portfolio Page 23" loading="lazy" decoding="async">
		</div>
    
		<!-- Spread 12: Pages 24-25 -->
		<div class="portfolio-spread">
	<img src="images/resized/1200/project1-24.jpg" alt="Portfolio Page 24" loading="lazy" decoding="async">
	<img src="images/resized/1200/project1-25.jpg" alt="Portfolio Page 25" loading="lazy" decoding="async">
		</div>
    
		<!-- Spread 13: Pages 26-27 -->
		<div class="portfolio-spread">
	<img src="images/resized/1200/project1-26.jpg" alt="Portfolio Page 26" loading="lazy" decoding="async">
	<img src="images/resized/1200/project1-27.jpg" alt="Portfolio Page 27" loading="lazy" decoding="async">
		</div>
    
		<!-- Spread 14: Pages 28-29 -->
		<div class="portfolio-spread">
	<img src="images/resized/1200/project1-28.jpg" alt="Portfolio Page 28" loading="lazy" decoding="async">
	<img src="images/resized/1200/project1-29.jpg" alt="Portfolio Page 29" loading="lazy" decoding="async">
		</div>
    
		<!-- Spread 15: Pages 30-31 -->
		<div class="portfolio-spread">
	<img src="images/resized/1200/project1-30.jpg" alt="Portfolio Page 30" loading="lazy" decoding="async">
	<img src="images/resized/1200/project1-31.jpg" alt="Portfolio Page 31" loading="lazy" decoding="async">
		</div>
    
		<!-- Final Spread: Pages 32-33 -->
		<div class="portfolio-spread">
	<img src="images/resized/1200/project1-32.jpg" alt="Portfolio Page 32" loading="lazy" decoding="async">
	<img src="images/resized/1200/project1-33.jpg" alt="Portfolio Back Cover" loading="lazy" decoding="async">
			<div class="end-label">continue to first page</div>
		</div>
	</div>

	<!-- Navigation arrows -->
	<div class="portfolio-nav-bar" aria-label="Page navigation">
		<button class="portfolio-nav prev" id="prevBtn" aria-label="Previous page">â€¹</button>
		<button class="portfolio-nav next" id="nextBtn" aria-label="Next page">â€º</button>
	</div>

	<script>
		const container = document.getElementById('portfolioContainer');
		const prevBtn = document.getElementById('prevBtn');
		const nextBtn = document.getElementById('nextBtn');

		let currentPage = 0;

		// Dynamically compute total pages depending on current layout mode
		function getTotalPages() {
			const isMobileMode = container.classList.contains('mobile-mode');
			if (isMobileMode) {
				return container.querySelectorAll('.mobile-page').length;
			}
			return container.querySelectorAll('.portfolio-cover, .portfolio-spread').length;
		}

		function updateNavigation() {
			prevBtn.classList.toggle('hidden', currentPage === 0);
			nextBtn.classList.remove('hidden');
		}

		function scrollToPage(pageIndex) {
			if (pageIndex < 0) pageIndex = 0;
			const total = getTotalPages();
			if (pageIndex >= total) pageIndex = 0; // Loop back to first page
      
			currentPage = pageIndex;
			const targetScroll = currentPage * window.innerWidth;
			container.scrollTo({ left: targetScroll, behavior: 'smooth' });
			updateNavigation();
		}

		prevBtn.addEventListener('click', () => scrollToPage(currentPage - 1));
		nextBtn.addEventListener('click', () => scrollToPage(currentPage + 1));

		// Track scroll position to update current page
		container.addEventListener('scroll', () => {
			const scrollLeft = container.scrollLeft;
			const newPage = Math.round(scrollLeft / window.innerWidth);
			if (newPage !== currentPage) {
				currentPage = newPage;
				updateNavigation();
			}
		});

		// Keyboard navigation
		document.addEventListener('keydown', (e) => {
			if (e.key === 'ArrowLeft') scrollToPage(currentPage - 1);
			if (e.key === 'ArrowRight') scrollToPage(currentPage + 1);
		});

		// Set gradient height to match images within each spread
		function updateSpreadHeights() {
			document.querySelectorAll('.portfolio-spread').forEach(spread => {
				const imgs = Array.from(spread.querySelectorAll('img'));
				if (imgs.length === 0) return;
				const heights = imgs.map(img => img.clientHeight).filter(h => h > 0);
				const maxH = heights.length ? Math.max(...heights) : 0;
				if (maxH > 0) {
					spread.style.setProperty('--spread-img-height', `${maxH}px`);
				}
			});
		}

		// Build mobile single-page slides from spreads
		function buildMobileSlides() {
			// Remove existing mobile slides
			document.querySelectorAll('#portfolioContainer .mobile-page').forEach(n => n.remove());
			const containerEl = document.getElementById('portfolioContainer');
			const cover = containerEl.querySelector('.portfolio-cover');
			const spreads = Array.from(containerEl.querySelectorAll('.portfolio-spread'));
			const mobileSlides = [];
			// Cover as first slide
			if (cover) {
				const slide = document.createElement('div');
				slide.className = 'mobile-page';
				const img = cover.querySelector('img').cloneNode(true);
				slide.appendChild(img);
				mobileSlides.push(slide);
			}
			// Each image in spreads becomes a slide
			spreads.forEach(spread => {
				const imgs = Array.from(spread.querySelectorAll('img'));
				imgs.forEach(img => {
					const slide = document.createElement('div');
					slide.className = 'mobile-page';
					slide.appendChild(img.cloneNode(true));
					mobileSlides.push(slide);
				});
			});
			// Append slides at the end
			mobileSlides.forEach(slide => containerEl.appendChild(slide));
		}

		function isPortraitMobile() {
			const portrait = window.matchMedia('(orientation: portrait)').matches;
			const narrow = window.innerWidth <= 900; // tablets in portrait and phones
			return portrait && narrow;
		}

		function applyLayoutMode() {
			const containerEl = document.getElementById('portfolioContainer');
			if (isPortraitMobile()) {
				containerEl.classList.add('mobile-mode');
				buildMobileSlides();
			} else {
				containerEl.classList.remove('mobile-mode');
				// Mobile slides are not shown; they can remain appended but hidden
			}
			// After switching modes or (re)building slides, make sure navigation state is correct
			const total = getTotalPages();
			if (currentPage >= total) currentPage = Math.max(0, total - 1);
			updateNavigation();
		}

		// Recalculate when images load and on resize
		function setHeaderOffset() {
			const header = document.querySelector('header');
			const h = header ? header.getBoundingClientRect().height : 0;
			document.documentElement.style.setProperty('--header-h', `${h}px`);
		}

		window.addEventListener('load', () => {
			setHeaderOffset();
			updateSpreadHeights();
			// Insert a non-scaled shadow to match the spread image area
			document.querySelectorAll('.portfolio-spread').forEach(spread => {
				if (!spread.querySelector('.spread-shadow')) {
					const shadow = document.createElement('div');
					shadow.className = 'spread-shadow';
					spread.insertBefore(shadow, spread.firstChild);
				}
			});
			applyLayoutMode();
			updateNavigation();
		});
		// Set header offset ASAP without waiting for images
		document.addEventListener('DOMContentLoaded', () => {
			setHeaderOffset();
			applyLayoutMode();
		});
		window.addEventListener('resize', () => {
			setHeaderOffset();
			updateSpreadHeights();
			applyLayoutMode();
		});
		document.querySelectorAll('.portfolio-spread img').forEach(img => {
			img.addEventListener('load', updateSpreadHeights, { once: true });
		});

		// Add responsive srcset/sizes and WebP <picture> wrappers to flipbook images
		function enhanceFlipbookImages() {
			const imgs = document.querySelectorAll('#portfolioContainer img');
			imgs.forEach(img => {
				const src = img.getAttribute('src') || '';
				// Only process images from the resized/1200 folder
				const m = src.match(/^images\/resized\/1200\/(.+)\.(jpg|jpeg|png)$/i);
				if (!m) return;
				const base = m[1];
				const ext = m[2].toLowerCase();

				// Build srcsets
				const widths = [400, 800, 1200];
				const srcset = widths.map(w => `images/resized/${w}/${base}.${ext} ${w}w`).join(', ');
				const webpSrcset = widths.map(w => `images/resized/${w}/${base}.webp ${w}w`).join(', ');

				// Sizes: spreads are ~45vw on desktop, cover up to ~86vw; mobile slides 90vw
				const isCover = img.closest('.portfolio-cover') !== null;
				const sizes = isCover
					? '(max-width: 900px) 90vw, 86vw'
					: '(max-width: 900px) 90vw, 45vw';

				// If not already wrapped, create <picture> with WebP first
				if (img.parentElement && img.parentElement.tagName.toLowerCase() !== 'picture') {
					const picture = document.createElement('picture');
					const webp = document.createElement('source');
					webp.setAttribute('type', 'image/webp');
					webp.setAttribute('srcset', webpSrcset);
					webp.setAttribute('sizes', sizes);
					const fallback = document.createElement('source');
					fallback.setAttribute('type', ext === 'png' ? 'image/png' : 'image/jpeg');
					fallback.setAttribute('srcset', srcset);
					fallback.setAttribute('sizes', sizes);
					img.setAttribute('srcset', srcset);
					img.setAttribute('sizes', sizes);
					if (!img.hasAttribute('decoding')) img.setAttribute('decoding', 'async');
					if (!img.hasAttribute('loading')) img.setAttribute('loading', 'lazy');

					const parent = img.parentElement;
					parent.insertBefore(picture, img);
					picture.appendChild(webp);
					picture.appendChild(fallback);
					picture.appendChild(img);
				} else {
					// Already inside <picture>: just update attributes
					img.setAttribute('srcset', srcset);
					img.setAttribute('sizes', sizes);
					if (!img.hasAttribute('decoding')) img.setAttribute('decoding', 'async');
					if (!img.hasAttribute('loading')) img.setAttribute('loading', 'lazy');
				}
			});
		}

		enhanceFlipbookImages();
	</script>
</body>
</html>
